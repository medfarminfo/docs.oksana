# Подключение к серверу

## Имя/адрес сервера

Каждой системе бронирования выделяется собственное имя сервера для взаимодействия.

IP-адрес сервера оператора может меняться со временем, поэтому не следует делать привязки к IP-адресу.


## Формат сообщений

Все обращения к серверу должны выполняться по протоколу HTTPS, методом POST.

Содержимое запроса указывается в теле (body) вызова, в формате либо XML, либо JSON. Ответ сервера (body ответа) будет в том же формате (XML или JSON).

Необходимо добавить в запрос заголовок `Content-Type` (со значением либо `application/xml`, либо `application/json`, согласно формату запроса), чтобы сервер понял в каком формате его считывать тело (body) запроса.

У XML-сообщений первой строкой должна быть строка `<?xml version="1.0" encoding="UTF-8"?>`.


Кодировка тела (body) запроса и ответа - UTF-8.


## Авторизация

Для авторизации (отсеивания обращений третьих лиц) используется Basic-авторизация ([RFC 7617](https://tools.ietf.org/html/rfc7617)).

В каждом запросе система бронирования должна добавлять заголовок `Authorization` со значением вида `Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==`, где строка `QWx...` содержит закодированные логин и пароль по алгоритму *base64(login + ":" + pass)*.

Пара `login` + `pass` создается для каждой системы бронирования после выполнения работ по интеграции.


## Анализ ответа сервера

При разборе ответа сервера необходимо сначала проверить HTTP Status-Code ответа ([RFC 7231, раздел 6](https://tools.ietf.org/html/rfc7231#section-6)), в частности:
  * 200 - сервер понял запрос и ответил на него, можно считывать body ответа
  * 400-499 - проблема в запросе (не заполнены обязательные поля, некорректные типы данных, отрицательные количества или суммы, нарушения контрольных проверок и т.п.). Body ответа может содержать более детальное описание ошибки. Такой запрос (вместе с обстоятельствами его появления) надо сохранить в лог и передать программисту "на разбор".
  * 500-599 - ошибка сервера при выполнении запроса. Если ошибка повторяется, то следует сохранить текст запроса в лог и передать программистам на разбор.


Если HTTP Status-Code ответа равен 200, то значит тело (body) ответа соответствует документации и его можно считывать и анализировать.